# 도커 이미지 생성

### 도커 파일 만들기

- **도커 파일**
    - 도커 파일이란 도커 이미지를 만들기 위한 설정 파일
    - 컨테이너가 어떻게 행동해야 하는지에 대한 설정을 정의
- **도커 파일 생성 순서**
    - 베이스 이미지 명시
    - 추가적으로 필요한 파일을 다운 받기 위한 몇 가지 명령어를 명시
    - 컨테이너 시작시 실행될 명령어를 명시
- **베이스 이미지**
    - 도커 이미지는 여러개의 레이어 그 중에서 베이스 이미지는 이 이미지의 기반이 되는 부분
    - 레이어는 중간 단계의 이미지
    - **FROM** : 이미지 생성시 기반이 되는 이미지 레이어
        - `<이미지 이름>:<태그>` 형식으로 작성 (태그를 안 붙이면 최신버전 다운)
    - **RUN** : 도커 이미지가 생성되기 전에 수행할 쉘 명령어
    - **CMD** : 컨테이너가 시작되었을 때 실행할 실행 파일 또는 쉘 스크립트
        - 해당 명령어는 `DockFile` 내에 1회만 사용 가능

```jsx
# 베이스 이미지를 명시해준다.
FROM baseImage

# 추가적으로 필요한 파일들을 다운로드 받는다.
RUN command

# 컨테이너 시작 시 실행될 명령어를 명시해준다. 
CMD [ "excutable" ]
```

### 도커 파일로 도커 이미지 생성

- 도커 파일에 입력된 것들이 도커 클라이언트에 전달되어서 도커 서버가 인식하게 해야함.
- `docker build ./` 또는 `docker build.`
    - 해당 디렉토리 내에서 `dockerfile`이라는 파일을 찾아서 도커 클라이언트에 전달
- `docker build -t johnahn/hello:latest .`
    - **-t <도커 아이디>/<프로젝트명>:<버전>**

![Untitled](https://user-images.githubusercontent.com/106054507/192514580-5b467b8d-d5a1-4891-a993-a421bebf82d1.png)


- 베이스 이미지에서 다른 종속성이나 새로운 커맨드를 추가할 때는 임시 컨테이너를 만든 후 그 컨테이너를 토대로 새로운 이미지를 만듬. 그리고 그 임시 컨테이너는 지워준다

### Working Directory 명시

- 이미지 안에서 애플리케이션 소스 코드를 가지고 있을 디렉터리를 생성해야함.
    - 디렉터리가 애플리케이션에 `working directory`
- **명시해야하는 이유**
    - 베이스 이미지에 중복되는 폴더가 있다면 `COPY`를 함으로써 새로 추가되는 폴더에 원래 있던 폴더가 덮어 써져 버림.
    - 모든 파일이 한 디렉토리에 들어가 버리니 복잡성 증가
    

### Docker Volume

![Untitled 1](https://user-images.githubusercontent.com/106054507/192514605-823110d9-22b5-4f3f-a458-7f5772024947.png)

- `docker run -d -p 5000:8080 -v /usr/src/app/ -v ${pwd}:/usr/src/app  <이미지 아이디>`
    - `v %cd%:/usr/src/app` : 윈도우 사용자
- **PWD (print working directory)** :현재 작업 중인 디렉터리의 이름을 출력하는 데 쓰임.
